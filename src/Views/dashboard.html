@viewModel Views.Dashboard.ViewModel

<!DOCTYPE html>
<html lang="en" xmlns:dot="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <title>Blokčejn</title>
    <dot:RequiredResource Name="bulma.css" />
    <script>
        var s = new WebSocket("ws://" + location.host + "/ws");
        s.onmessage = function (ev) {
            document.getElementById("refresh_hack_button").click();
        }
    </script>
</head>

<body>
    <dot:Button id="refresh_hack_button" style="display:none" Click="{command: 0}" PostBack.Concurrency="Deny" />

    <div class="columns">
        <div class="column">
            <h2 class="panel-heading">
                Sklad
            </h2>
            <div class="panel-block">
                <table class="table">
                    <thead>
                        <th>Surovina</th>
                        <th>Množství</th>
                        <th>V odchozích transakcích</th>
                    </thead>
                    <dot:Repeater DataSource="{value: AccountData}" WrapperTagName="tbody">
                        <tr class="">
                            <td>{{value: _this.AssetName}}</td>
                            <td>{{value: _this.Spendable}}</td>
                            <td Visible="{value: _this.TransactionLocked != 0}">{{value:TransactionLocked}}</td>
                        </tr>
                    </dot:Repeater>
                </table>
            </div>
        </div>
        <div class="column">
            <h2 class="panel-heading">
                Transakce
            </h2>

            <div class="panel-block">
                <p class="control has-icons-left">
                    <dot:Button Click="{staticCommand: TransactionModalOpen = true}" Text="Nová transakce" class="button"/>
                    <span class="icon is-small is-left">
                    <i class="fas fa-search" aria-hidden="true"></i>
                  </span>
                </p>
            </div>

            <p class="panel-heading">
                Příchozí transakce
            </p>

            <dot:Repeater DataSource="{value: ComingTransactions}" RenderWrapperTag="false" IncludeInPage="{value: _page.EvaluatingOnClient}">
                <div class="panel-block">
                    <div Validation.Target="{value: _this}">
                        <p style="">
                            <strong data-bind="text: '\'' + $data.From().Fields()[0]() + '\':'"></strong>
                            {{value: Notes}}
                        </p>
                        <dot:Repeater DataSource="{value: Assets}" WrapperTagName="p">
                            <SeparatorTemplate> | </SeparatorTemplate>
                            <span class="" Class-is-danger="{value: Count < 0}">{{value: Count}}: {{value: Name}}</span>
                        </dot:Repeater>
                        <dot:Validator Value="{value: _this}" />
                        <div class="field has-addons">
                            <p class="control">
                                <dot:Button Text="Přijmout" class="button is-success" Click="{command: _root.AcceptTransaction(_this)}" />
                            </p>
                            <p class="control">
                                <dot:Button Text="Zrušit" class="button is-danger" onclick="if (!confirm('Fakt jí chceš zrušit')) return false;" Click="{command: _root.CancelTransaction(Id)}" />
                            </p>
                        </div>
                    </div>
                </div>
            </dot:Repeater>
            <p class="panel-heading">
                Odchozí transakce
            </p>
            <dot:Repeater DataSource="{value: MyPendingTransactions}" RenderWrapperTag="false" IncludeInPage="{value: _page.EvaluatingOnClient}">
                <div class="panel-block">
                    <div>
                        <p style="">
                            <strong data-bind="text: ('\'' + $data.To() + '\':')"></strong>
                            {{value: Notes}}
                        </p>
                        <dot:Repeater DataSource="{value: Assets}" WrapperTagName="p">
                            <SeparatorTemplate> | </SeparatorTemplate>
                            <span class="" Class-is-danger="{value: Count > 0}">{{value: Count}}: {{value: Name}}</span>
                        </dot:Repeater>
                        <div class="field has-addons">
                            <p class="control">
                                <dot:Button Text="Zrušit" class="button is-danger" onclick="if (!confirm('Fakt jí chceš zrušit')) return false;" Click="{command: _root.CancelTransaction(Id)}" />
                            </p>
                        </div>
                    </div>
                </div>
            </dot:Repeater>
        </div>
        <div class="column">
            <h2 class="panel-heading">
                Těžba
            </h2>
            <!--<table class="table">-->
            <!--<thead>-->
                <!--<tr>-->
                <!--<th>Jméno</th>-->
                <!--<th>Surovina</th>-->
                <!--<th>Souřadnice kódu</th>-->
                <!--</tr>-->
            <!--</thead>-->
            <dot:Repeater DataSource="{value: Mines}" WrapperTagName="div" RenderWrapperTag="false" IncludeInPage="{value: _page.EvaluatingOnClient}">
                <div class="panel-block">
                    <div>
                    <p><strong>{{value: Name}}:</strong> {{value: Resource}} (+{{value: NextYield}})</p>
                    <div>
                            <form>
                                <div class="field has-addons has-addons-right">
                                    <div class="control">
                                        <span class="button is-static">
                                            [ <dot:Repeater DataSource="{value: NextCoords}" WrapperTagName="span">
                                                  <SeparatorTemplate> | </SeparatorTemplate>
                                                  {{value: _this}}
                                              </dot:Repeater> ]
                                        </span>
                                    </div>
                                    <div class="control">
                                        <dot:TextBox class="input" Text="{value: _root.MineCodes[_index]}" placeholder="zadej kód z dolu" Validator.Value="{value: _root.MineCodes[_index]}" Validator.InvalidCssClass="is-danger" />
                                    </div>
                                    <div class="control">
                                        <dot:Button class="button" Text="Potvrdit" Click="{command: _root.Mine(_index)}" IsSubmitButton />
                                    </div>
                                </div>
                            </form>
                    </div>
                    </div>
                </div>
            </dot:Repeater>
            <!--</table>-->
            <div class="panel-block">
                <form>
                    <dot:Validator Value="{value: NewMineName}" />
                    <div class="field has-addons">
                        <div class="control">
                            <dot:TextBox class="input" placeholder="Přidat nový důl" Text="{value: NewMineName}" Validator.Value="{value: NewMineName}" Validator.InvalidCssClass="is-danger" />
                        </div>
                        <div class="control">
                            <dot:Button Text="Přidat" Click="{command: DiscoverMine()}" IsSubmitButton class="button" />
                        </div>
                    </div>


                </form>
            </div>
        </div>
    </div>
    <!--<div class="column">-->
    <!--<h2></h2>-->
    <!--</div>-->
    <form action="#">
    <div class="modal" Class-is-active="{value: TransactionModalOpen}">
        <div class="modal-background"></div>
        <div class="modal-card" Validation.Target="{value: TransactionModal}">
            <header class="modal-card-head">
                <p class="modal-card-title">Nová transakce</p>
                <dot:Button Click="{staticCommand: TransactionModalOpen = false}" ButtonTagName="button" class="delete is-large" aria-label="close"></dot:Button>
            </header>
            <section class="modal-card-body" DataContext="{value: TransactionModal}">
                <p>
                    <dot:ComboBox DataSource="{value: _root.OtherTeamNames}" SelectedValue="{value: To}" EmptyItemText="Komu poslat..." Validator.Value="{value: To}" Validator.InvalidCssClass="is-danger" class="input" />
                </p>

                <p>
                    <table class="table">
                        <dot:Repeater DataSource="{value: Assets}" WrapperTagName="tbody">
                            <tr>
                                <td>{{value: Name}}</td>
                                <td><dot:TextBox Type="number" Text="{value: Count}" class="input" Validator.Value="{value: Count}" Validator.InvalidCssClass="is-danger" Validator.SetToolTipText placeholder="kolik se má poslat"></dot:TextBox></td>
                                <td><dot:Validator Value="{value: Count}"></dot:Validator></td>
                            </tr>
                        </dot:Repeater>
                    </table>
                </p>
                <p>
                    <dot:TextBox Type="multiline" Text="{value: Notes}" placeholder="poznámka" class="textarea" rows="5" />
                </p>
                <dot:ValidationSummary />
            </section>
            <footer class="modal-card-foot">
                <dot:Button class="button is-success" Click="{command: SubmitTransaction()}" IsSubmitButton="true">Odeslat</dot:Button>
                <dot:Button Click="{staticCommand: TransactionModalOpen = false}" class="button" aria-label="close">Zavřít</dot:Button>
            </footer>
        </div>
    </div>
    </form>
</body>

</html>